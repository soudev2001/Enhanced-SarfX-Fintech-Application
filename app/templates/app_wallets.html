{% extends "app_base.html" %}

{% block title %}My Wallets - SarfX{% endblock %}

{% block content %}
<div class="wise-main-content">
    <!-- Page Header -->
    <div class="wise-page-header">
        <div class="wise-page-header-content">
            <h1 class="wise-page-title">My Wallets</h1>
            <p class="wise-page-subtitle">Manage your multi-currency balances</p>
        </div>
        <button class="wise-btn wise-btn-primary" onclick="showAddCurrencyModal()">
            <i data-lucide="plus-circle"></i>
            Add Currency
        </button>
    </div>

    <!-- Total Balance Card -->
    <div class="wise-total-balance-card">
        <div class="wise-total-label">Total Balance (USD Equivalent)</div>
        <div class="wise-total-value">${{ "%.2f"|format(total_balance.total_usd) }}</div>
    </div>

    <!-- Currency Wallets Grid -->
    <div class="wise-wallets-grid">
        {% for wallet in total_balance.wallets %}
        <div class="wise-wallet-card" onclick="showWalletDetails('{{ wallet.currency }}')">
            <div class="wise-wallet-flag">
                {% if wallet.currency == 'USD' %}üá∫üá∏
                {% elif wallet.currency == 'EUR' %}üá™üá∫
                {% elif wallet.currency == 'GBP' %}üá¨üáß
                {% elif wallet.currency == 'MAD' %}üá≤üá¶
                {% elif wallet.currency == 'CHF' %}üá®üá≠
                {% else %}üíµ{% endif %}
            </div>
            <div class="wise-wallet-info">
                <div class="wise-wallet-currency">{{ wallet.currency }}</div>
                <div class="wise-wallet-label">Balance</div>
            </div>
            <div class="wise-wallet-balance">
                {% if wallet.currency == 'EUR' %}‚Ç¨{% elif wallet.currency == 'GBP' %}¬£{% elif wallet.currency == 'MAD' %}ÿØ.ŸÖ.{% elif wallet.currency == 'CHF' %}CHF {% else %}${% endif %}{{ "%.2f"|format(wallet.balance) }}
            </div>
            <i data-lucide="chevron-right" class="wise-wallet-arrow"></i>
        </div>
        {% else %}
        <div class="wise-empty-state">
            <i data-lucide="wallet" class="wise-empty-icon"></i>
            <h3>No Wallets Yet</h3>
            <p>Add your first currency to start managing multi-currency balances</p>
            <button class="wise-btn wise-btn-primary" onclick="showAddCurrencyModal()">
                <i data-lucide="plus-circle"></i>
                Add Currency
            </button>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Wallet Details Modal -->
<div class="wise-modal" id="walletDetailsModal">
    <div class="wise-modal-backdrop" onclick="closeWalletDetails()"></div>
    <div class="wise-modal-content wise-modal-lg">
        <div class="wise-modal-header">
            <div class="wise-modal-header-left">
                <span class="wise-modal-flag" id="modalFlag">üá™üá∫</span>
                <div>
                    <h2 class="wise-modal-title"><span id="modalCurrency">EUR</span> Wallet Details</h2>
                    <p class="wise-modal-subtitle">Manage transactions and rate alerts</p>
                </div>
            </div>
            <button class="wise-modal-close" onclick="closeWalletDetails()">
                <i data-lucide="x"></i>
            </button>
        </div>
        
        <div class="wise-modal-tabs">
            <button class="wise-modal-tab active" data-tab="history">History</button>
            <button class="wise-modal-tab" data-tab="alerts">Alerts</button>
            <button class="wise-modal-tab" data-tab="accounts">Bank Accounts</button>
        </div>
        
        <div class="wise-modal-body">
            <!-- History Tab -->
            <div class="wise-tab-content active" id="historyTab">
                <div class="wise-transactions-list">
                    {% for tx in transactions[:5] %}
                    <div class="wise-tx-item">
                        <div class="wise-tx-info">
                            <div class="wise-tx-title">
                                {% if tx.type == 'deposit' %}Received from Exchange
                                {% elif tx.type == 'withdrawal' %}Withdrawn at ATM
                                {% elif tx.type == 'transfer' %}Sent to {{ tx.get('recipient', 'User') }}
                                {% else %}{{ tx.type|title }}{% endif %}
                            </div>
                            <div class="wise-tx-date">{{ tx.created_at.strftime('%Y-%m-%d at %H:%M') if tx.created_at else 'N/A' }}</div>
                        </div>
                        <div class="wise-tx-amount {% if tx.type == 'deposit' %}positive{% else %}negative{% endif %}">
                            {% if tx.type == 'deposit' %}+{% else %}-{% endif %}{{ tx.currency }}{{ "%.2f"|format(tx.amount) }}
                        </div>
                    </div>
                    {% else %}
                    <div class="wise-empty-transactions">
                        <i data-lucide="receipt" class="wise-empty-icon-sm"></i>
                        <p>No transactions yet</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Alerts Tab -->
            <div class="wise-tab-content" id="alertsTab">
                <div class="wise-alert-form">
                    <h4>Set Rate Alert</h4>
                    <p class="wise-text-muted">Get notified when the rate reaches your target</p>
                    <div class="wise-form-row">
                        <div class="wise-form-group">
                            <label>Target Rate</label>
                            <input type="number" class="wise-input" placeholder="e.g. 0.95" step="0.0001">
                        </div>
                        <div class="wise-form-group">
                            <label>Alert Type</label>
                            <select class="wise-select">
                                <option>Above target</option>
                                <option>Below target</option>
                            </select>
                        </div>
                    </div>
                    <button class="wise-btn wise-btn-primary">
                        <i data-lucide="bell"></i>
                        Create Alert
                    </button>
                </div>
            </div>
            
            <!-- Bank Accounts Tab -->
            <div class="wise-tab-content" id="accountsTab">
                <div class="wise-bank-accounts">
                    <div class="wise-bank-account-card">
                        <div class="wise-bank-icon">üè¶</div>
                        <div class="wise-bank-info">
                            <div class="wise-bank-name">No linked bank accounts</div>
                            <div class="wise-bank-details">Link a bank account to receive funds directly</div>
                        </div>
                    </div>
                    <button class="wise-btn wise-btn-secondary">
                        <i data-lucide="plus"></i>
                        Add Bank Account
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Currency Modal -->
<div class="wise-modal" id="addCurrencyModal">
    <div class="wise-modal-backdrop" onclick="closeAddCurrencyModal()"></div>
    <div class="wise-modal-content">
        <div class="wise-modal-header">
            <h2 class="wise-modal-title">Add New Currency</h2>
            <button class="wise-modal-close" onclick="closeAddCurrencyModal()">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="wise-modal-body">
            <div class="wise-currency-grid">
                <div class="wise-currency-option" onclick="addCurrency('USD')">
                    <span class="wise-currency-flag">üá∫üá∏</span>
                    <span class="wise-currency-code">USD</span>
                    <span class="wise-currency-name">US Dollar</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('EUR')">
                    <span class="wise-currency-flag">üá™üá∫</span>
                    <span class="wise-currency-code">EUR</span>
                    <span class="wise-currency-name">Euro</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('GBP')">
                    <span class="wise-currency-flag">üá¨üáß</span>
                    <span class="wise-currency-code">GBP</span>
                    <span class="wise-currency-name">British Pound</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('MAD')">
                    <span class="wise-currency-flag">üá≤üá¶</span>
                    <span class="wise-currency-code">MAD</span>
                    <span class="wise-currency-name">Moroccan Dirham</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('CHF')">
                    <span class="wise-currency-flag">üá®üá≠</span>
                    <span class="wise-currency-code">CHF</span>
                    <span class="wise-currency-name">Swiss Franc</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('CAD')">
                    <span class="wise-currency-flag">üá®üá¶</span>
                    <span class="wise-currency-code">CAD</span>
                    <span class="wise-currency-name">Canadian Dollar</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('AUD')">
                    <span class="wise-currency-flag">üá¶üá∫</span>
                    <span class="wise-currency-code">AUD</span>
                    <span class="wise-currency-name">Australian Dollar</span>
                </div>
                <div class="wise-currency-option" onclick="addCurrency('JPY')">
                    <span class="wise-currency-flag">üáØüáµ</span>
                    <span class="wise-currency-code">JPY</span>
                    <span class="wise-currency-name">Japanese Yen</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Total Balance Card */
.wise-total-balance-card {
    background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary, #ff8c42));
    border-radius: 16px;
    padding: 32px;
    text-align: center;
    margin-bottom: 32px;
    color: white;
}

.wise-total-label {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 8px;
}

.wise-total-value {
    font-size: 48px;
    font-weight: 800;
}

/* Wallets Grid */
.wise-wallets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
}

.wise-wallet-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.wise-wallet-card:hover {
    border-color: var(--brand-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.wise-wallet-flag {
    font-size: 36px;
}

.wise-wallet-info {
    flex: 1;
}

.wise-wallet-currency {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
}

.wise-wallet-label {
    font-size: 13px;
    color: var(--text-secondary);
}

.wise-wallet-balance {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
}

.wise-wallet-arrow {
    width: 20px;
    height: 20px;
    color: var(--text-muted);
}

/* Modal Styles */
.wise-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.wise-modal.active {
    display: flex;
}

.wise-modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.wise-modal-content {
    position: relative;
    background: var(--card-bg);
    border-radius: 20px;
    max-width: 480px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.wise-modal-lg {
    max-width: 600px;
}

.wise-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px;
    border-bottom: 1px solid var(--border-color);
}

.wise-modal-header-left {
    display: flex;
    align-items: center;
    gap: 16px;
}

.wise-modal-flag {
    font-size: 40px;
}

.wise-modal-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.wise-modal-subtitle {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 4px 0 0 0;
}

.wise-modal-close {
    background: var(--bg-secondary);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s;
}

.wise-modal-close:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.wise-modal-tabs {
    display: flex;
    padding: 0 24px;
    border-bottom: 1px solid var(--border-color);
}

.wise-modal-tab {
    background: none;
    border: none;
    padding: 16px 20px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.wise-modal-tab:hover {
    color: var(--text-primary);
}

.wise-modal-tab.active {
    color: var(--brand-primary);
    border-bottom-color: var(--brand-primary);
}

.wise-modal-body {
    padding: 24px;
}

.wise-tab-content {
    display: none;
}

.wise-tab-content.active {
    display: block;
}

/* Transactions List */
.wise-transactions-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.wise-tx-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
}

.wise-tx-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 4px;
}

.wise-tx-date {
    font-size: 13px;
    color: var(--text-secondary);
}

.wise-tx-amount {
    font-weight: 700;
    font-size: 16px;
}

.wise-tx-amount.positive {
    color: #10b981;
}

.wise-tx-amount.negative {
    color: #ef4444;
}

/* Empty States */
.wise-empty-state {
    text-align: center;
    padding: 48px 24px;
    grid-column: 1 / -1;
}

.wise-empty-icon {
    width: 64px;
    height: 64px;
    color: var(--text-muted);
    margin-bottom: 16px;
}

.wise-empty-icon-sm {
    width: 32px;
    height: 32px;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.wise-empty-transactions {
    text-align: center;
    padding: 32px;
    color: var(--text-secondary);
}

/* Alert Form */
.wise-alert-form h4 {
    margin: 0 0 4px 0;
    color: var(--text-primary);
}

.wise-alert-form .wise-text-muted {
    margin-bottom: 20px;
}

.wise-form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
}

/* Bank Accounts */
.wise-bank-accounts {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.wise-bank-account-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: 12px;
}

.wise-bank-icon {
    font-size: 32px;
}

.wise-bank-name {
    font-weight: 600;
    color: var(--text-primary);
}

.wise-bank-details {
    font-size: 13px;
    color: var(--text-secondary);
}

/* Currency Grid */
.wise-currency-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.wise-currency-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 20px;
    background: var(--bg-secondary);
    border: 2px solid transparent;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.wise-currency-option:hover {
    border-color: var(--brand-primary);
    background: var(--bg-tertiary);
}

.wise-currency-flag {
    font-size: 32px;
}

.wise-currency-code {
    font-weight: 700;
    color: var(--text-primary);
}

.wise-currency-name {
    font-size: 12px;
    color: var(--text-secondary);
}

@media (max-width: 640px) {
    .wise-total-value {
        font-size: 36px;
    }
    
    .wise-currency-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .wise-form-row {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Initialize icons
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});

// Wallet Details Modal
function showWalletDetails(currency) {
    const modal = document.getElementById('walletDetailsModal');
    const flags = {
        'USD': 'üá∫üá∏',
        'EUR': 'üá™üá∫',
        'GBP': 'üá¨üáß',
        'MAD': 'üá≤üá¶',
        'CHF': 'üá®üá≠'
    };
    
    document.getElementById('modalFlag').textContent = flags[currency] || 'üíµ';
    document.getElementById('modalCurrency').textContent = currency;
    modal.classList.add('active');
}

function closeWalletDetails() {
    document.getElementById('walletDetailsModal').classList.remove('active');
}

// Add Currency Modal
function showAddCurrencyModal() {
    document.getElementById('addCurrencyModal').classList.add('active');
}

function closeAddCurrencyModal() {
    document.getElementById('addCurrencyModal').classList.remove('active');
}

function addCurrency(code) {
    alert(`Adding ${code} wallet... This feature will be available soon!`);
    closeAddCurrencyModal();
}

// Modal Tabs
document.querySelectorAll('.wise-modal-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.wise-modal-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        // Show corresponding content
        document.querySelectorAll('.wise-tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(tabName + 'Tab').classList.add('active');
    });
});

// Close modals on escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeWalletDetails();
        closeAddCurrencyModal();
    }
});
</script>
{% endblock %}
