{% extends "app_base.html" %}

{% block title %}{% if action == 'create' %}Ajouter une banque{% else %}Modifier la banque{% endif %} - Admin SarfX{% endblock %}

{% block content %}
<div class="space-y-6 pb-24">
    <!-- Header -->
    <div class="pt-2">
        <a href="{{ url_for('admin_banks.list_banks') }}" class="text-adaptive-muted text-sm flex items-center gap-1 mb-2">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Retour
        </a>
        <h1 class="text-2xl font-bold text-adaptive">
            {% if action == 'create' %}
            <i data-lucide="plus-circle" class="w-6 h-6 text-emerald-500 inline mr-2"></i>
            Ajouter une banque
            {% else %}
            <i data-lucide="edit" class="w-6 h-6 text-blue-500 inline mr-2"></i>
            Modifier la banque
            {% endif %}
        </h1>
    </div>

    <!-- Form -->
    <form method="POST" enctype="multipart/form-data" class="space-y-4">
        <!-- Name -->
        <div class="glass-panel p-4 rounded-xl">
            <label for="name" class="block text-sm font-medium text-adaptive-muted mb-2">
                Nom de la banque *
            </label>
            <input type="text" id="name" name="name" required
                   value="{% if bank %}{{ bank.name }}{% endif %}"
                   class="glass-input w-full rounded-xl px-4 py-3"
                   placeholder="Ex: Attijariwafa Bank">
        </div>

        <!-- Code -->
        <div class="glass-panel p-4 rounded-xl">
            <label for="code" class="block text-sm font-medium text-adaptive-muted mb-2">
                Code de la banque * <span class="text-xs">(ex: attijariwafa)</span>
            </label>
            <input type="text" id="code" name="code" required
                   value="{% if bank %}{{ bank.code }}{% endif %}"
                   {% if action == 'edit' %}readonly{% endif %}
                   class="glass-input w-full rounded-xl px-4 py-3 {% if action == 'edit' %}opacity-60 cursor-not-allowed{% endif %}"
                   placeholder="Ex: attijariwafa">
            {% if action == 'edit' %}
            <p class="text-xs text-adaptive-muted mt-2">Le code ne peut pas être modifié après création</p>
            {% endif %}
        </div>

        <!-- Website -->
        <div class="glass-panel p-4 rounded-xl">
            <label for="website" class="block text-sm font-medium text-adaptive-muted mb-2">
                Site web
            </label>
            <input type="url" id="website" name="website"
                   value="{% if bank %}{{ bank.website }}{% endif %}"
                   class="glass-input w-full rounded-xl px-4 py-3"
                   placeholder="https://www.attijariwafa.com">
        </div>

        <!-- Description -->
        <div class="glass-panel p-4 rounded-xl">
            <label for="description" class="block text-sm font-medium text-adaptive-muted mb-2">
                Description
            </label>
            <textarea id="description" name="description" rows="3"
                      class="glass-input w-full rounded-xl px-4 py-3 resize-none"
                      placeholder="Description de la banque...">{% if bank %}{{ bank.description }}{% endif %}</textarea>
        </div>

        <!-- Logo Upload -->
        <div class="glass-panel p-4 rounded-xl">
            <label class="block text-sm font-medium text-adaptive-muted mb-3">
                Logo de la banque
            </label>
            
            {% if bank and bank.logo %}
            <div class="mb-4 p-4 bg-white/5 rounded-lg flex items-center justify-center">
                <img src="{{ bank.logo }}" alt="{{ bank.name }}" class="max-h-16 object-contain">
            </div>
            <p class="text-sm text-adaptive-muted mb-3">Logo actuel (télécharger un nouveau fichier pour le remplacer)</p>
            {% endif %}
            
            <div class="flex items-center justify-center w-full">
                <label for="logo" class="flex flex-col items-center justify-center w-full h-32 border-2 border-white/10 border-dashed rounded-xl cursor-pointer bg-white/5 hover:bg-white/10 transition">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <i data-lucide="upload-cloud" class="w-10 h-10 mb-3 text-adaptive-muted"></i>
                        <p class="mb-2 text-sm text-adaptive-muted">
                            <span class="font-semibold text-adaptive">Cliquer pour télécharger</span>
                        </p>
                        <p class="text-xs text-adaptive-muted">PNG, JPG, SVG (MAX. 5MB)</p>
                    </div>
                    <input id="logo" name="logo" type="file" accept=".png,.jpg,.jpeg,.svg" class="hidden" onchange="previewLogo(this)">
                </label>
            </div>
            
            <!-- Preview -->
            <div id="logoPreview" class="mt-4 hidden">
                <p class="text-sm font-medium text-adaptive mb-2">Aperçu:</p>
                <div class="p-4 bg-white/5 rounded-lg flex items-center justify-center">
                    <img id="previewImage" src="" alt="Preview" class="max-h-16 object-contain">
                </div>
            </div>
        </div>

        <!-- Active Status -->
        <div class="glass-panel p-4 rounded-xl">
            <label class="flex items-center cursor-pointer">
                <input type="checkbox" id="is_active" name="is_active" 
                       {% if not bank or bank.is_active %}checked{% endif %}
                       class="sr-only peer">
                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500 relative"></div>
                <span class="ml-3 text-sm font-medium text-adaptive">Banque active (visible sur le site)</span>
            </label>
        </div>

        <!-- Submit Buttons -->
        <div class="flex gap-3 pt-2">
            <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-xl font-bold transition hover:opacity-90">
                {% if action == 'create' %}
                <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                Créer la banque
                {% else %}
                <i data-lucide="check" class="w-4 h-4 inline mr-2"></i>
                Enregistrer
                {% endif %}
            </button>
            <a href="{{ url_for('admin_banks.list_banks') }}" class="px-6 py-3 glass-panel rounded-xl font-bold text-adaptive-muted hover:text-adaptive transition">
                Annuler
            </a>
        </div>
    </form>
</div>

<!-- Admin Navigation -->
<nav class="fixed bottom-0 left-0 right-0 glass-panel border-t border-white/10 px-6 py-3 z-40">
    <div class="flex justify-around items-center max-w-lg mx-auto">
        <a href="{{ url_for('admin.dashboard') }}" class="flex flex-col items-center gap-1 text-adaptive-muted hover:text-adaptive transition">
            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
            <span class="text-xs">Dashboard</span>
        </a>
        <a href="{{ url_for('admin.users') }}" class="flex flex-col items-center gap-1 text-adaptive-muted hover:text-adaptive transition">
            <i data-lucide="users" class="w-5 h-5"></i>
            <span class="text-xs">Users</span>
        </a>
        <a href="{{ url_for('admin.transactions') }}" class="flex flex-col items-center gap-1 text-adaptive-muted hover:text-adaptive transition">
            <i data-lucide="receipt" class="w-5 h-5"></i>
            <span class="text-xs">Txns</span>
        </a>
        <a href="{{ url_for('admin_banks.list_banks') }}" class="flex flex-col items-center gap-1 text-[rgb(224,90,3)]">
            <i data-lucide="building-2" class="w-5 h-5"></i>
            <span class="text-xs font-bold">Banques</span>
        </a>
        <a href="{{ url_for('app.home') }}" class="flex flex-col items-center gap-1 text-adaptive-muted hover:text-adaptive transition">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span class="text-xs">App</span>
        </a>
    </div>
</nav>

<script>
function previewLogo(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('logoPreview').classList.remove('hidden');
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock %}
