{% extends "app_base.html" %}

{% block title %}Admin Associé Banque - SarfX{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-2026.css') }}">
<style>
    body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-dashboard-wrapper fade-in-up">

    {% if bank %}
    <!-- Bank Hero Card -->
    <div class="admin-bank-hero-card mb-6">
        <div class="admin-bank-hero-bg"></div>
        <div class="admin-bank-hero-content">
            <div class="admin-bank-hero-info">
                {% if bank.logo %}
                <img src="{{ bank.logo }}" alt="{{ bank.name }}" class="admin-bank-hero-logo">
                {% else %}
                <div class="admin-bank-hero-logo-placeholder">
                    <i data-lucide="landmark" class="w-8 h-8"></i>
                </div>
                {% endif %}
                <div>
                    <h1 class="admin-bank-hero-name">{{ bank.name }}</h1>
                    <p class="admin-bank-hero-code">Code: {{ bank.code }}</p>
                </div>
            </div>
            <div class="admin-bank-hero-meta">
                <div class="admin-bank-hero-meta-item">
                    <span class="admin-bank-hero-meta-label">Swift Code</span>
                    <span class="admin-bank-hero-meta-value">{{ bank.swift_code or 'N/A' }}</span>
                </div>
                <div class="admin-bank-hero-meta-item">
                    <span class="admin-bank-hero-meta-label">Ville</span>
                    <span class="admin-bank-hero-meta-value">{{ bank.city or 'N/A' }}</span>
                </div>
                <div class="admin-bank-hero-meta-item">
                    <span class="admin-bank-hero-meta-label">Statut</span>
                    <span class="admin-bank-hero-meta-value">
                        {% if bank.is_active %}
                        <span class="admin-badge admin-badge-success">
                            <i data-lucide="check-circle" class="w-3 h-3"></i>
                            Actif
                        </span>
                        {% else %}
                        <span class="admin-badge admin-badge-danger">
                            <i data-lucide="x-circle" class="w-3 h-3"></i>
                            Inactif
                        </span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="admin-stats-grid stagger-container">
        <div class="admin-stat-card stagger-item" style="--stagger-delay: 1">
            <div class="admin-stat-icon" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1)); color: #6366f1;">
                <i data-lucide="map-pin" class="w-6 h-6"></i>
            </div>
            <div class="admin-stat-content">
                <p class="admin-stat-label">ATMs</p>
                <p class="admin-stat-value">{{ stats.atm_count }}</p>
            </div>
        </div>

        <div class="admin-stat-card stagger-item" style="--stagger-delay: 2">
            <div class="admin-stat-icon admin-stat-icon-success">
                <i data-lucide="users" class="w-6 h-6"></i>
            </div>
            <div class="admin-stat-content">
                <p class="admin-stat-label">Utilisateurs</p>
                <p class="admin-stat-value">{{ stats.user_count }}</p>
            </div>
        </div>

        <div class="admin-stat-card stagger-item" style="--stagger-delay: 3">
            <div class="admin-stat-icon admin-stat-icon-info">
                <i data-lucide="receipt" class="w-6 h-6"></i>
            </div>
            <div class="admin-stat-content">
                <p class="admin-stat-label">Transactions</p>
                <p class="admin-stat-value">{{ stats.transaction_count }}</p>
            </div>
        </div>

        <div class="admin-stat-card stagger-item" style="--stagger-delay: 4">
            <div class="admin-stat-icon admin-stat-icon-warning">
                <i data-lucide="activity" class="w-6 h-6"></i>
            </div>
            <div class="admin-stat-content">
                <p class="admin-stat-label">Appels API</p>
                <p class="admin-stat-value">{{ stats.api_calls }}</p>
            </div>
        </div>
    </div>

    <!-- Management Actions -->
    <div class="admin-card">
        <div class="admin-card-header">
            <h2 class="admin-card-title">
                <i data-lucide="settings" class="w-5 h-5"></i>
                Gestion de {{ bank.name }}
            </h2>
        </div>
        <div class="admin-card-body">
            <div class="admin-quick-actions-grid">
                <a href="{{ url_for('app.admin_api_control') }}" class="admin-quick-action">
                    <div class="admin-quick-action-icon bg-gradient-to-br from-indigo-500 to-purple-600">
                        <i data-lucide="plug" class="w-5 h-5"></i>
                    </div>
                    <span class="admin-quick-action-label">Contrôle API</span>
                    <span class="admin-quick-action-badge">Config</span>
                </a>

                <a href="{{ url_for('app.admin_atm_management') }}" class="admin-quick-action">
                    <div class="admin-quick-action-icon bg-gradient-to-br from-pink-500 to-rose-600">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                    </div>
                    <span class="admin-quick-action-label">Gérer les ATMs</span>
                    <span class="admin-quick-action-count">{{ stats.atm_count }}</span>
                </a>

                <a href="{{ url_for('app.bank_settings') }}" class="admin-quick-action">
                    <div class="admin-quick-action-icon bg-gradient-to-br from-cyan-500 to-blue-600">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </div>
                    <span class="admin-quick-action-label">Paramètres Banque</span>
                    <span class="admin-quick-action-badge">Config</span>
                </a>

                <a href="{{ url_for('admin.admin_my_wallet') }}" class="admin-quick-action">
                    <div class="admin-quick-action-icon bg-gradient-to-br from-amber-500 to-orange-600">
                        <i data-lucide="wallet" class="w-5 h-5"></i>
                    </div>
                    <span class="admin-quick-action-label">Mon Portefeuille</span>
                    <span class="admin-quick-action-badge">Finance</span>
                </a>
            </div>
        </div>
    </div>

    {% else %}
    <!-- No Bank Associated -->
    <div class="admin-card">
        <div class="admin-card-body">
            <div class="admin-empty-state">
                <div class="admin-empty-icon">
                    <i data-lucide="landmark" class="w-16 h-16"></i>
                </div>
                <h2 class="admin-empty-title">Aucune banque associée</h2>
                <p class="admin-empty-desc">
                    Vous devez être associé à une banque pour accéder à ce dashboard.
                    Contactez un administrateur pour être assigné à une banque partenaire.
                </p>
                <a href="{{ url_for('app.associate_bank') }}" class="admin-btn admin-btn-primary">
                    <i data-lucide="link" class="w-4 h-4"></i>
                    S'associer à une banque
                </a>
            </div>
        </div>
    </div>
    {% endif %}

</div>

<!-- Bottom Navigation -->
{% include 'admin/partials/bottom_nav.html' %}
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/lucide@latest"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        lucide.createIcons();
    });
</script>
{% endblock %}
